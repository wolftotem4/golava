# Golava

this document is still work in progress

## Contents

- [Getting started](https://github.com/wolftotem4/golava#getting-started)
- [Login Attempt Protection (Redis)](https://github.com/wolftotem4/golava#login-attempt-protection-redis)
- [WIP] Example: E-mail authentification (sqlx/gorm)
- [WIP] Example: E-mail authentification (ent)

## Getting started

### Install `golava-new` command

```shell
$ go install github.com/wolftotem4/golava-new
```

### Generate & edit `setup.yaml` file

For avoiding unnecessary package dependencies, some config needs to be setup before generating the actual project.

```shell
$ golava-new -generate
# setup.yaml file generated
```

Edits `setup.yaml` which is generated by the command.

```yaml
db:
  # Specify the driver of your DB (sqlite/mysql/postgres)
  driver: mysql

  # Specify the type of DB package you want to use (sqlx/gorm/ent)
  type: sqlx
```

After this step, the command `golara-new` should be able to create new project with minimal dependencies.

### Generate new project

Usage: `golava-new <project> <moudle-path>`

```shell
$ golava-new myproject example.com/hello/myproject
```

### Edit `./<your-project>/.env`

Put your DSN (including DB host, username, password, and DB name) in `.env`, please Google `golang mysql` (or sqlite/postgres) for more information.

Don't forget `LISTEN_ADDR`, and `BASE_URL`.

```dotenv
APP_NAME=Golava
APP_DEBUG=true
APP_KEY=

LISTEN_ADDR=127.0.0.1:8080
BASE_URL=http://127.0.0.1:8080/

DB_DRIVER=mysql
# Put your DSN here.
DB_DSN=user:password@/dbname

GIN_MODE=release
SESSION_LIFETIME=120
SESSION_PATH=/
SESSION_DOMAIN=
SESSION_COOKIE=app_session
SESSION_SAME_SITE=lax
```

### Run migrations

```shell
$ go run ./cmd/migrate
```

### Run this project

Finally, you can run this project and see your work.

```shell
$ go run ./cmd/serve
```

You can see the work by the url you have configured in `.env` now.

## Login Attempt Protection (Redis)

### Require redis package.

```shell
$ go get github.com/redis/go-redis/v9
```

### Edit `internal/app/app.go`, add line `Redis *redis.Client` to **App** struct.

```go
import (
	"github.com/jmoiron/sqlx"
	"github.com/redis/go-redis/v9"
	"github.com/wolftotem4/golava-core/golava"
)

type App struct {
	golava.App
	DB    *sqlx.DB
	
	// add this line
	Redis *redis.Client
}
```

### Create `internal/bootstrap/redis.go`

```go
package bootstrap

import "github.com/redis/go-redis/v9"

func initRedis() *redis.Client {
	return redis.NewClient(&redis.Options{
		Addr:     "localhost:6379",
		Password: "",
		DB:       0,
	})
}
```

### Edit `internal/bootstrap/app.go`

```go
return &app.App{
		DB:    db,

		// add this line
		Redis: initRedis(),

		App: golava.App{
```

### Strip `.example` from Go filenames

Rename `internal/ratelimit/login/redis.go.example`, `internal/ratelimit/middleware/ratelimit.go.example`, strip `.example` from their filenames.

Congratulations!  Now, you can use `LoginRateLimit` middleware for protecting your login requests

```go
import (
	// ...
	ratemid "github.com/wolftotem4/golava/internal/ratelimit/middleware"
	// ...
)

// ...

r.POST("/login", ratemid.LoginRateLimit("username", 3, 1*time.Minute), home.SubmitLogin)
```

## Example: E-mail authentification (sqlx/gorm)

this section is WIP

## Example: E-mail authentification (ent)

this section is WIP
